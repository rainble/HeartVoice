<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="author" content="webthemez.com">
<meta name="viewport" content="width=device-width, initial-scale=1">





<title>Home</title>
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/flexslider.css">
<link rel="stylesheet" href="css/jquery.fancybox.css">
<link rel="stylesheet" href="css/main.css"> 
<link href="jPlayer-2.9.2/dist/skin/pink.flag/css/jplayer.pink.flag.min.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="css/responsive.css">
<link rel="stylesheet" href="css/font-icon.css">
<link rel="stylesheet" href="css/animate.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
</head>

<body>
<!-- header section -->

<div class="rythm-bass">

<section class="banner" role="banner">
  <header id="header">
    <div class="header-content clearfix"> <span class="logo"><a href="index.html">tunes</a></span>
      <nav class="navigation" role="navigation">
        <ul class="primary-nav">
          <li><a href="#intro" class="twist1">About</a></li>
          <li><a href="#services" class="twist1">You Get</a></li>
          <li><a href="#Playlist" class="twist1">Playlist</a></li>
		  <li><a href="#package" class="twist1">Scenarios</a></li>
          <li><a href="#tours" class="twist1">UPCOMING</a></li>
          <li><a href="#teams" class="twist1">Our Team</a></li>
          <li><a href="#testimonials" class="twist1">Testimonials</a></li>
          <li><a href="#contact" class="twist1">Contact</a></li>
        </ul>
      </nav>
      <a href="#" class="nav-toggle">Menu<span></span></a> </div>
  </header>
  <!-- banner text -->
  <div class="container">
    <div class="col-md-10 col-md-offset-1">
      <div class="banner-text text-center swing1">
        <span style="white-space:normal">
        <h1 class="shake1">Rock Music</h1>
        <p class="shake1">Hello Welcome To Tunes Music</p>
        <audio id="ai-feedback"  autoplay></audio>
        <button type="button" class="btn btn-link btn-block swing1" onclick="startRecording()">Say what you want</button>  
        <!-- <input type="button" value="获取录音" onclick="obtainRecord()"/>   -->
        <button type="button" class="btn btn-link btn-block swing1" onclick="stopRecord()">I've done</button>  
        <input type="button" class="shake1" value="播放录音" onclick="playRecord(url)"/>
            <label>A1</label><input id='a1' type='radio' value='1' name='test1'  />
            <label>A1</label><input id='a2' type='radio' value='2' name='test2'  />
            <label>A1</label><input id='a3' type='radio' value='3' name='test3'  />
            <label>A1</label><input id='a4' type='radio' value='4' name='test4'  />
            <label>A1</label><input id='a5' type='radio' value='5' name='test5'  />
            <label>A1</label><input id='a6' type='radio' value='6' name='test6'  />
        </span>
      </div>
      <!-- banner text --> 
    </div>
  </div>
</section>
<!-- header section --> 
<!-- intro section -->
<section id="intro" class="section intro">
  <div class="container">
    <div class="col-md-8 col-md-offset-2 text-center">
      <h3 class="swing1">The Awesome Music AI System</h3>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis eu libero scelerisque ligula sagittis faucibus eget quis lacus.Lorem ipsum dolor sit amet, consectetur adipiscing elit.Lorem ipsum dolor sit amet, consectetur adipiscing elit.</p> 
        <a href="#Playlist" class="btn btn-large">Playlist</a> 
    </div>
  </div>
</section>
<!-- intro section --> 
<!-- services section -->
<section id="services" class="services service-section">
  <div class="container">
  <div class="section-header">
                <h2 class="swing1">What You Get</h2>
                <p class="wow fadeInDown animated">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa <br> semper aliquam quis mattis quam.</p>
            </div>
    <div class="row"> 
      <div class="col-md-4 col-sm-6 services text-center"> <span class="icon icon-briefcase"></span>
        <div class="services-content">
          <h5>GERNATE</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis eu libero scelerisque ligula sagittis faucibus eget quis lacus.</p>
        </div>
      </div>
      <div class="col-md-4 col-sm-6 services text-center"> <span class="icon icon-tools"></span>
        <div class="services-content">
          <h5>STYLE CHANGE</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis eu libero scelerisque ligula sagittis faucibus eget quis lacus.</p>
        </div>
      </div> 
      <div class="col-md-4 col-sm-6 services text-center"> <span class="icon icon-megaphone"></span>
        <div class="services-content">
          <h5>VOICE INTERACTION</h5>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis eu libero scelerisque ligula sagittis faucibus eget quis lacus.</p>
        </div>
      </div> 
    </div>
  </div>
</section>
<!-- services section --> 

<section id="Playlist" class="playlistList">
  <div class="container">
      <div class="section-header">
                <h2 class="swing1">Playlist</h2>
                <p class="wow fadeInDown animated">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa <br> semper aliquam quis mattis quam.</p>
            </div>
    <div class="row">  
         <div id="jquery_jplayer_2" class="jp-jplayer"></div>
<div id="jp_container_2" class="jp-audio" role="application" aria-label="media player">
	<div class="jp-type-playlist">
		<div class="jp-gui jp-interface">
			<div class="jp-volume-controls">
				<button class="jp-mute" role="button" tabindex="0">mute</button>
				<button class="jp-volume-max" role="button" tabindex="0">max volume</button>
				<div class="jp-volume-bar">
					<div class="jp-volume-bar-value"></div>
				</div>
			</div>
			<div class="jp-controls-holder">
				<div class="jp-controls">
					<button class="jp-previous" role="button" tabindex="0">previous</button>
					<button class="jp-play" role="button" tabindex="0">play</button>
					<button class="jp-stop" role="button" tabindex="0">stop</button>
					<button class="jp-next" role="button" tabindex="0">next</button>
				</div>
				<div class="jp-progress">
					<div class="jp-seek-bar">
						<div class="jp-play-bar"></div>
					</div>
				</div>
				<div class="jp-current-time" role="timer" aria-label="time">&nbsp;</div>
				<div class="jp-duration" role="timer" aria-label="duration">&nbsp;</div>
				<div class="jp-toggles">
					<button class="jp-repeat" role="button" tabindex="0">repeat</button>
					<button class="jp-shuffle" role="button" tabindex="0">shuffle</button>
				</div>
			</div>
		</div>
		<div class="jp-playlist">
			<ul>
				<li>&nbsp;</li>
			</ul>
		</div>
		<div class="jp-no-solution">
			<span>Update Required</span>
			To play the media you will need to either update your browser to a recent version or update your Flash plugin.
		</div>
	</div>
</div>	
	 </div>
</section>	 
<!-- package section -->
<section id="package" class="packageList">
  <div class="container">
      <div class="section-header">
                <h2 class="swing1">Our Scenarios</h2>
                <p class="wow fadeInDown animated">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa <br> semper aliquam quis mattis quam.</p>
            </div>
    <div class="row">  
            <div class="col-md-6">
            
            	<div class="package wow fadeInLeft animated" data-wow-offset="250" data-wow-delay="200ms">
                	<h5>Earth Alive</h5>
                    <ul class="list-default">
                    	<li>Lorem ipsum dolor sit amet, consectetur</li>
                    	<li>adipiscing eliteger gravida velit quis dolo</li>
                    	<li>Pellentesque elit tortor</li>
                    </ul>
                    <strong class="price"><small>$</small>38</strong>
                </div><!-- end package -->
                
                <div class="package wow fadeInLeft animated" data-wow-offset="200" data-wow-delay="300m">
                	<h5>Light Blue</h5>
                    <ul class="list-default">
                    	<li>Lorem ipsum dolor sit amet, consectetur</li>
                    	<li>adipiscing eliteger gravida velit quis dolo</li>
                    	<li>Pellentesque elit tortor</li>
                    </ul>
                    <strong class="price"><small>$</small>75</strong>
                </div><!-- end package -->
                
            </div><!-- end col-md-6 -->
            <div class="col-md-6">
            
            	<div class="package wow fadeInRight animated" data-wow-offset="250" data-wow-delay="500m" >
                	<h5>Love Life</h5>
                    <ul class="list-default">
                    	<li>Lorem ipsum dolor sit amet, consectetur</li>
                    	<li>adipiscing eliteger gravida velit quis dolo</li>
                    	<li>Pellentesque elit tortor</li>
                    </ul>
                    <strong class="price"><small>$</small>15</strong>
                </div><!-- end package -->
                
                <div class="package wow fadeInRight animated" data-wow-offset="200" data-wow-delay="600m">
                	<h5>Back Street</h5>
                    <ul class="list-default">
                    	<li>Lorem ipsum dolor sit amet, consectetur</li>
                    	<li>adipiscing eliteger gravida velit quis dolo</li>
                    	<li>Pellentesque elit tortor</li>
                    </ul>
                    <strong class="price"><small>$</small>84</strong>
                </div><!-- end package -->
                
            </div><!-- end col-md-6 -->
        </div><!-- end row -->    
  </div>
</section>
<!-- package section --> 



<!-- our team section -->
<section id="tours" class="section teams"> 
	<div class="container">
	    <div class="section-header">
                <h2 class="swing1">Upcoming Functions</h2>
                <p class="wow fadeInDown animated">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa <br> semper aliquam quis mattis quam.</p>
            </div>
		<div class="row">
			<div class="col-md-6">
				<img src="images/pic2.jpg" class="img-responsive" alt="">
			</div>
			<div class="col-md-6">
				<div class="col-md-11">
					<h3>Our Plans</h3>
					<ul class="tour-list">
						<li>
							<div class="tour-date">1<span>M<br></span></div>
							<div class="tour-info">NewYork, US - <a href="#">Music Area</a></div>
							<div class="tour-ticket"><a href="#">Buy Ticket</a></div>
						</li>
						<li>
							<div class="tour-date">2<span>U<br></span></div>
							<div class="tour-info">Delhi, Ind - <a href="#">Open Theater</a></div>
							<div class="tour-ticket"><a href="#">Buy Ticket</a></div>
						</li>
						<li>
							<div class="tour-date">3<span>S<br></span></div>
							<div class="tour-info">Texas, US - <a href="#">Eden Gardens</a></div>
							<div class="tour-ticket"><a href="#">Buy Ticket</a></div>
						</li>
						<li>
							<div class="tour-date">4<span>I<br></span></div>
							<div class="tour-info">England, UK - <a href="#">BNK Stadium</a></div>
							<div class="tour-ticket"><a href="#">Buy Ticket</a></div>
						</li>
						<li>
							<div class="tour-date">5<span>C<br><em>2016</em></span></div>
							<div class="tour-info">Tokiyo, Japan - <a href="#">KMT Grounds</a></div>
							<div class="tour-ticket"><a href="#">Buy Ticket</a></div>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
 </section>

<!-- gallery section -->
<section id="gallery" class="gallery section">
    <div class="container-fluid">
      <div class="section-header">
                  <h2 class="wow fadeInDown animated" class="swing1">Events</h2>
                  <p class="wow fadeInDown animated">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa <br> semper aliquam quis mattis quam.</p>
              </div>
      <div class="row no-gutter">
        <!--放3d效果-->

        <audio id="song" src="" style="display:none;"></audio>
        <div class="container">
          <div class="play-btn">PLAY</div>
            <div class="three-container"></div>

        </div>
      </div>
    </div>
  </section>
  <!-- gallery section --> 


<!-- our team section -->
<section id="teams" class="section teams">
  <div class="container">
      <div class="section-header">
                <h2 class="wow fadeInDown animated" class="swing1">Our Gang</h2>
                <p class="wow fadeInDown animated">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa <br> semper aliquam quis mattis quam.</p>
            </div>
            
    <div class="row">
      <div class="col-md-12 col-sm-6" align="center">
        <div class="person"><img src="images/team--1.png" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Jonh Dow</h4>
            <h5 class="role">Founder</h5>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit eget risus vitae massa.</p>
          </div>
          <ul class="social-icons clearfix">
            <li><a href="#"><span class="fa fa-facebook"></span></a></li>
            <li><a href="#"><span class="fa fa-twitter"></span></a></li> 
            <li><a href="#"><span class="fa fa-google-plus"></span></a></li> 
          </ul>
        </div>
      </div>
      <h1>     </h1>
      <div class="col-md-3 col-sm-6">
        <div class="person"> <img src="images/team--2.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Markus Linn</h4>
            <h5 class="role">Music</h5>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit eget risus vitae massa.</p>
          </div>
          <ul class="social-icons clearfix">
            <li><a href="#" class=""><span class="fa fa-facebook"></span></a></li>
            <li><a href="#" class=""><span class="fa fa-twitter"></span></a></li> 
            <li><a href="#" class=""><span class="fa fa-google-plus"></span></a></li> 
          </ul>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="person"> <img src="images/team-3.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Chris Jemes</h4>
            <h5 class="role">Singer</h5>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit eget risus vitae massa.</p>
          </div>
          <ul class="social-icons clearfix">
            <li><a href="#" class=""><span class="fa fa-facebook"></span></a></li>
            <li><a href="#" class=""><span class="fa fa-twitter"></span></a></li> 
            <li><a href="#" class=""><span class="fa fa-google-plus"></span></a></li> 
          </ul>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
        <div class="person"> <img src="images/team-4.jpg" alt="" class="img-responsive">
          <div class="person-content">
            <h4>Vintes Mars</h4>
            <h5 class="role">Singler</h5>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit eget risus vitae massa.</p>
          </div>
          <ul class="social-icons clearfix">
            <li><a href="#" class=""><span class="fa fa-facebook"></span></a></li>
            <li><a href="#" class=""><span class="fa fa-twitter"></span></a></li> 
            <li><a href="#" class=""><span class="fa fa-google-plus"></span></a></li> 
          </ul>
        </div>
      </div>
      <div class="col-md-3 col-sm-6">
          <div class="person"> <img src="images/team--2.jpg" alt="" class="img-responsive">
            <div class="person-content">
              <h4>Markus Linn</h4>
              <h5 class="role">Music</h5>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit eget risus vitae massa.</p>
            </div>
            <ul class="social-icons clearfix">
              <li><a href="#" class=""><span class="fa fa-facebook"></span></a></li>
              <li><a href="#" class=""><span class="fa fa-twitter"></span></a></li> 
              <li><a href="#" class=""><span class="fa fa-google-plus"></span></a></li> 
            </ul>
          </div>
        </div>
    </div>
  </div>
</section>
<!-- our team section --> 
<!-- Testimonials section -->
<section id="testimonials" class="section testimonials no-padding">
  <div class="container-fluid">
    <div class="row no-gutter">
      <div class="flexslider">
        <ul class="slides">
          <li>
            <div class="col-md-12">
              <blockquote>
                <h1>"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa 
semper aliquam quis mattis consectetur adipiscing elit.." </h1>
                <p>Chris Mentsl</p>
              </blockquote>
            </div>
          </li>
          <li>
            <div class="col-md-12">
              <blockquote>
                <h1>"Praesent eget risus vitae massa Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa 
semper aliquam quis mattis consectetur adipiscing elit.." </h1>
                <p>Kristean velnly</p>
              </blockquote>
            </div>
          </li>
          <li>
            <div class="col-md-12">
              <blockquote>
                <h1>"Consectetur adipiscing elit Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa 
semper aliquam quis mattis consectetur adipiscing elit.." </h1>
                <p>Markus Denny</p>
              </blockquote>
            </div>
          </li>
          <li>
            <div class="col-md-12">
              <blockquote>
                <h1>"Vitae massa semper aliquam Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa 
semper aliquam quis mattis consectetur adipiscing elit.." </h1>
                <p>John Doe</p>
              </blockquote>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</section>
<!-- Testimonials section --> 

<!-- contact section -->
<section id="contact" class="section">
  <div class="container">
      <div class="section-header">
                <h2 class="wow fadeInDown animated">Contact Us</h2>
                <p class="wow fadeInDown animated">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent eget risus vitae massa <br> semper aliquam quis mattis quam.</p>
            </div>
    <div class="row">
      <div class="col-md-8 col-md-offset-2 conForm">       
        <div id="message"></div>
        <form method="post" action="php/contact.php" name="cform" id="cform">
          <input name="name" id="name" type="text" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 radius1" placeholder="Your name..." >
          <input name="email" id="email" type="email" class=" col-xs-12 col-sm-12 col-md-12 col-lg-12 noMarr" placeholder="Email Address..." >
          <textarea name="comments" id="comments" cols="" rows="" class="col-xs-12 col-sm-12 col-md-12 col-lg-12" placeholder="Message..."></textarea>
          <input type="submit" id="submit" name="send" class="submitBnt" value="Send">
          <div id="simple-msg"></div>
        </form>
      </div>
    </div>
  </div>
</section>
<!-- contact section --> 
<!-- JS FILES --> 
<script type="text/javascript" src="js/jquery.min.js"></script> 
<script type="text/javascript" src="js/bootstrap.min.js"></script> 
<script type="text/javascript" src="js/jquery.flexslider-min.js"></script> 
<script type="text/javascript" src="js/jquery.fancybox.pack.js"></script> 
<script type="text/javascript" src="js/retina.min.js"></script> 
<script type="text/javascript" src="js/modernizr.js"></script> 
<script type="text/javascript" src="js/main.js"></script> 
<script type="text/javascript" src="js/record.js"></script>
<script type="text/javascript" src="js/three.min.js"></script>
<script type="text/javascript" src="js/OrbitControls-2.js"></script>
<script type="text/javascript" src="js/jquery.contact.js"></script> 
<script type="text/javascript" src="js/rythm.js"></script>
<script type="text/javascript" src="jPlayer-2.9.2/dist/jplayer/jquery.jplayer.min.js"></script>
<script type="text/javascript" src="jPlayer-2.9.2/dist/add-on/jplayer.playlist.min.js"></script> 
<!-- <script type="text/javascript" src="js/kuxuantexiao.js"></script> -->
<script>

var mContainer;
var mCamera, mRenderer;
var mControls;

var mShadowColor = 0x13091B; //0x1B0914

var mScene;
var mLight;
var mLight2;
var mLight3;

var mUseAA = true;
var mParticleCount = 250000;
var mParticleSystem;

var mDuration;
var mPathLength = 32;

var mAudioElement = document.getElementById('song');
var mAnalyser;

var mPlayBtn = document.querySelector('.play-btn');
var mPlayBtnContainer = document.querySelector('.container');

mPlayBtn.addEventListener('click', function() {
    mPlayBtnContainer.style.display = 'none';
    mAudioElement.currentTime = 0;
    mAudioElement.play();
});
mAudioElement.addEventListener('ended', function() {
    mPlayBtnContainer.style.display = 'flex';
})


window.onload = function() {
    init();
};

function init() {
    initAudio();
    initTHREE();
    initControls();
    initParticleSystem();

    requestAnimationFrame(tick);
    window.addEventListener('resize', resize, false);
}

function initAudio() {
    mAudioElement.crossOrigin = "anonymous";
    mAudioElement.src = "music/1.mp3";

    mAnalyser = new SpectrumAnalyzer(mPathLength * 0.5, 0.80);
    mAnalyser.setSource(mAudioElement);
}

function initTHREE() {
    mRenderer = new THREE.WebGLRenderer({
        antialias: mUseAA
    });
    mRenderer.setSize(window.innerWidth, window.innerHeight);
    //mRenderer.setClearColor(0xffffff);
    mRenderer.setClearColor(mShadowColor);

    mContainer = document.getElementById('three-container');
    mContainer.appendChild(mRenderer.domElement);

    mCamera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 5000);
    mCamera.position.set(0, 0, 1200);

    mScene = new THREE.Scene();

    mLight = new THREE.PointLight(0xffffff, 1, 1200, 2);
    mLight.position.set(0, 0, 0);
    mScene.add(mLight);

    mLight2 = new THREE.DirectionalLight(0xFF311F, 0.25);
    mLight2.position.set(0, 1, 1);
    mScene.add(mLight2);

    mLight3 = new THREE.DirectionalLight(0x007A99, 0.25);
    mLight3.position.set(0, 1, -1);
    mScene.add(mLight3);
}

function initControls() {
    mControls = new THREE.OrbitControls(mCamera, mRenderer.domElement);
    mControls.autoRotate = true;
    mControls.enableZoom = false;
    mControls.enablePan = false;
    mControls.constraint.minPolarAngle = mControls.constraint.maxPolarAngle = Math.PI * 0.5;
}

function initParticleSystem() {
    var prefabGeometry = new THREE.PlaneGeometry(4, 4);
    var bufferGeometry = new THREE.BAS.PrefabBufferGeometry(prefabGeometry, mParticleCount);

    //bufferGeometry.computeVertexNormals();

    // generate additional geometry data
    var aDelayDuration = bufferGeometry.createAttribute('aDelayDuration', 2);
    var aPivot = bufferGeometry.createAttribute('aPivot', 3);
    var aAxisAngle = bufferGeometry.createAttribute('aAxisAngle', 4);
    var aColor = bufferGeometry.createAttribute('color', 3);

    var i, j, offset;

    // buffer time offset
    var delay;
    var duration;
    var prefabDelay = 0.00015;
    var vertexDelay = 0.0125;
    var minDuration = 32.0;
    var maxDuration = 56.5;

    mDuration = maxDuration + prefabDelay * mParticleCount + vertexDelay * prefabGeometry.vertices.length;
    console.log(mDuration);
    for (i = 0, offset = 0; i < mParticleCount; i++) {
        delay = i * prefabDelay;
        duration = THREE.Math.randFloat(minDuration, maxDuration);

        for (j = 0; j < prefabGeometry.vertices.length; j++) {
            aDelayDuration.array[offset++] = delay + j * vertexDelay;
            aDelayDuration.array[offset++] = duration;
        }
    }

    // buffer pivot
    var pivot = new THREE.Vector3();

    for (i = 0, offset = 0; i < mParticleCount; i++) {
        pivot.x = THREE.Math.randFloat(0, 2);
        pivot.y = THREE.Math.randFloat(0, 2);
        pivot.z = THREE.Math.randFloat(0, 2);

        for (j = 0; j < prefabGeometry.vertices.length; j++) {
            aPivot.array[offset++] = pivot.x;
            aPivot.array[offset++] = pivot.y;
            aPivot.array[offset++] = pivot.z;
        }
    }

    // buffer axis angle
    var axis = new THREE.Vector3();
    var angle = 0;

    for (i = 0, offset = 0; i < mParticleCount; i++) {
        axis.x = THREE.Math.randFloatSpread(2);
        axis.y = THREE.Math.randFloatSpread(2);
        axis.z = THREE.Math.randFloatSpread(2);
        axis.normalize();

        angle = Math.PI * THREE.Math.randInt(48, 64);

        for (j = 0; j < prefabGeometry.vertices.length; j++) {
            aAxisAngle.array[offset++] = axis.x;
            aAxisAngle.array[offset++] = axis.y;
            aAxisAngle.array[offset++] = axis.z;
            aAxisAngle.array[offset++] = angle;
        }
    }

    // buffer color
    var color = new THREE.Color();
    var h, s, l;

    for (i = 0, offset = 0; i < mParticleCount; i++) {
        //h = i / mParticleCount;
        h = THREE.Math.randFloat(0.5, 1.00);
        s = THREE.Math.randFloat(0.5, 0.75);
        l = THREE.Math.randFloat(0.25, 0.5);

        color.setHSL(h, s, l);

        for (j = 0; j < prefabGeometry.vertices.length; j++) {
            aColor.array[offset++] = color.r;
            aColor.array[offset++] = color.g;
            aColor.array[offset++] = color.b;
        }
    }

    // buffer spline (uniform)
    var pathArray = [];
    var radiusArray = [];
    var length = mPathLength;
    var x, y, z;

    for (i = 0; i < length; i++) {
        if (!i) {
            x = 0;
            y = -1400;
            z = 0;
        } else if (!(i - length + 1)) {
            x = 0;
            y = 1200;
            z = 0;
        } else {
            x = THREE.Math.randFloatSpread(600);
            y = (-400 + (800 / length) * i) + THREE.Math.randFloatSpread(200);
            z = THREE.Math.randFloatSpread(600);
        }

        pathArray.push(x, y, z);
        radiusArray.push(0);
    }

    var material = new THREE.BAS.PhongAnimationMaterial(
        // custom parameters & THREE.MeshPhongMaterial parameters
        {
            vertexColors: THREE.VertexColors,
            shading: THREE.FlatShading,
            side: THREE.DoubleSide,
            fog: true,
            defines: {
                PATH_LENGTH: pathArray.length / 3
            },
            uniforms: {
                uTime: {
                    type: 'f',
                    value: 0
                },
                //uDuration: {type: 'f', value: mDuration},
                uPath: {
                    type: 'fv',
                    value: pathArray
                },
                uRadius: {
                    type: 'fv1',
                    value: radiusArray
                },
                uRoundness: {
                    type: 'v2',
                    value: new THREE.Vector2(2, 2)
                }
            },
            shaderFunctions: [
                THREE.BAS.ShaderChunk['quaternion_rotation'],
                THREE.BAS.ShaderChunk['catmull-rom'],
                THREE.BAS.ShaderChunk['ease_in_out_cubic']
            ],
            shaderParameters: [
                'uniform float uTime;',
                'uniform vec3 uPath[PATH_LENGTH];',
                'uniform float uRadius[PATH_LENGTH];',
                'uniform vec2 uRoundness;',
                'attribute vec2 aDelayDuration;',
                'attribute vec3 aPivot;',
                'attribute vec4 aAxisAngle;'
            ],
            shaderVertexInit: [
                'float tDelay = aDelayDuration.x;',
                'float tDuration = aDelayDuration.y;',
                'float tTime = clamp(uTime - tDelay, 0.0, tDuration);',
                'float tProgress = tTime / tDuration;',

                'float angle = aAxisAngle.w * tProgress;',
                'vec4 tQuat = quatFromAxisAngle(aAxisAngle.xyz, angle);'
            ],
            shaderTransformNormal: [
                'objectNormal = rotateVector(tQuat, objectNormal);'
            ],
            shaderTransformPosition: [
                'float tMax = float(PATH_LENGTH - 1);',
                'float tPoint = tMax * tProgress;',
                'float tIndex = floor(tPoint);',
                'float tWeight = tPoint - tIndex;',

                'int i0 = int(max(0.0, tIndex - 1.0));',
                'int i1 = int(tIndex);',
                'int i2 = int(min(tIndex + 1.0, tMax));',
                'int i3 = int(min(tIndex + 2.0, tMax));',
                'vec3 p0 = uPath[i0];',
                'vec3 p1 = uPath[i1];',
                'vec3 p2 = uPath[i2];',
                'vec3 p3 = uPath[i3];',

                'float radius = catmullRom(uRadius[i0], uRadius[i1], uRadius[i2], uRadius[i3], tWeight);',
                'transformed += aPivot * radius;',

                'transformed = rotateVector(tQuat, transformed);',

                'transformed += catmullRom(p0, p1, p2, p3, uRoundness, tWeight);'
            ]
        },
        // THREE.MeshPhongMaterial uniforms
        {
            shininess: 16,
            specular: 0xffd700,
            emissive: mShadowColor
        }
    );

    mParticleSystem = new THREE.Mesh(bufferGeometry, material);
    mParticleSystem.frustumCulled = false;

    mScene.add(mParticleSystem);
}

function tick() {
    update();
    render();

    requestAnimationFrame(tick);
}

function update() {
    mControls.update();
    mAnalyser.updateSample();

    var uniform = mParticleSystem.material.uniforms['uRadius'].value;
    var data = mAnalyser.frequencyByteData;

    var dataArray = [];
    var cap = data.length * 0.5;
    var i;

    //for (i = cap - 1; i >= 0; i--) {
    for (i = 0; i < cap; i++) {
        dataArray.push(data[i]);
    }

    for (i = cap - 1; i >= 0; i--) {
        //for (i = 0; i < cap; i++) {
        dataArray.push(data[i]);
    }

    //for (i = cap - 1; i >= 0; i--) {
    for (i = 0; i < cap; i++) {
        dataArray.push(data[i]);
    }

    for (i = cap - 1; i >= 0; i--) {
        //for (i = 0; i < cap; i++) {
        dataArray.push(data[i]);
    }


    for (i = 0; i < dataArray.length; i++) {
        if (i && dataArray.length - i > 1) {
            var val = dataArray[i] / 255;
            uniform[i] = Math.max(1, val * val * val * 48);
        } else {
            uniform[i] = 128;
        }
    }


    var a0 = mAnalyser.getAverageFloat();

    var r = 8 * a0 * a0 * a0 + 1;

    mParticleSystem.material.uniforms['uRoundness'].value.set(r, r);

    var a1 = mAnalyser.getAverageFloat() * 2;
    mLight.intensity = a1 * a1;
    mLight2.intensity = a1 * a1 * a1 * a1 * 0.5;
    mLight3.intensity = a1 * a1 * a1 * a1 * 0.5;

    mParticleSystem.material.uniforms['uTime'].value = mAudioElement.currentTime || 0;
}

function render() {
    mRenderer.render(mScene, mCamera);
}

function resize() {
    mCamera.aspect = window.innerWidth / window.innerHeight;
    mCamera.updateProjectionMatrix();

    mRenderer.setSize(window.innerWidth, window.innerHeight);
}

/////////////////////////////////
// Spectrum Analyser
/////////////////////////////////

// https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode
function SpectrumAnalyzer(binCount, smoothingTimeConstant) {
    var Context = window["AudioContext"] || window["webkitAudioContext"];

    this.context = new Context();
    this.analyzerNode = this.context.createAnalyser();

    this.setBinCount(binCount);
    this.setSmoothingTimeConstant(smoothingTimeConstant);
}

SpectrumAnalyzer.prototype = {
    setSource: function(source) {
        //this.source = source;
        this.source = this.context.createMediaElementSource(source);
        this.source.connect(this.analyzerNode);
        this.analyzerNode.connect(this.context.destination);
    },

    setBinCount: function(binCount) {
        this.binCount = binCount;
        this.analyzerNode.fftSize = binCount * 2;

        this.frequencyByteData = new Uint8Array(binCount); // frequency
        this.timeByteData = new Uint8Array(binCount); // waveform
    },

    setSmoothingTimeConstant: function(smoothingTimeConstant) {
        this.analyzerNode.smoothingTimeConstant = smoothingTimeConstant;
    },

    getFrequencyData: function() {
        return this.frequencyByteData;
    },

    getTimeData: function() {
        return this.timeByteData;
    },
    // not save if out of bounds
    getAverage: function(index, count) {
        var total = 0;
        var start = index || 0;
        var end = start + (count || this.binCount);

        for (var i = start; i < end; i++) {
            total += this.frequencyByteData[i];
        }

        return total / (end - start);
    },
    getAverageFloat: function(index, count) {
        return this.getAverage(index, count) / 255;
    },

    updateSample: function() {
        this.analyzerNode.getByteFrequencyData(this.frequencyByteData);
        this.analyzerNode.getByteTimeDomainData(this.timeByteData);
    }
};

///////////////
// buffer animation system 
///////////////

THREE.BAS = {};

THREE.BAS.ShaderChunk = {};

THREE.BAS.ShaderChunk["animation_time"] = "float tDelay = aAnimation.x;\nfloat tDuration = aAnimation.y;\nfloat tTime = clamp(uTime - tDelay, 0.0, tDuration);\nfloat tProgress = ease(tTime, 0.0, 1.0, tDuration);\n";

THREE.BAS.ShaderChunk["catmull-rom"] = "vec3 catmullRom(vec3 p0, vec3 p1, vec3 p2, vec3 p3, float t)\n{\n    vec3 v0 = (p2 - p0) * 0.5;\n    vec3 v1 = (p3 - p1) * 0.5;\n    float t2 = t * t;\n    float t3 = t * t * t;\n\n    return vec3((2.0 * p1 - 2.0 * p2 + v0 + v1) * t3 + (-3.0 * p1 + 3.0 * p2 - 2.0 * v0 - v1) * t2 + v0 * t + p1);\n}\n\nvec3 catmullRom(vec3 p0, vec3 p1, vec3 p2, vec3 p3, vec2 c, float t)\n{\n    vec3 v0 = (p2 - p0) * c.x;\n    vec3 v1 = (p3 - p1) * c.y;\n    float t2 = t * t;\n    float t3 = t * t * t;\n\n    return vec3((2.0 * p1 - 2.0 * p2 + v0 + v1) * t3 + (-3.0 * p1 + 3.0 * p2 - 2.0 * v0 - v1) * t2 + v0 * t + p1);\n}\n\nfloat catmullRom(float p0, float p1, float p2, float p3, float t)\n{\n    float v0 = (p2 - p0) * 0.5;\n    float v1 = (p3 - p1) * 0.5;\n    float t2 = t * t;\n    float t3 = t * t * t;\n\n    return float((2.0 * p1 - 2.0 * p2 + v0 + v1) * t3 + (-3.0 * p1 + 3.0 * p2 - 2.0 * v0 - v1) * t2 + v0 * t + p1);\n}\n\nfloat catmullRom(float p0, float p1, float p2, float p3, vec2 c, float t)\n{\n    float v0 = (p2 - p0) * c.x;\n    float v1 = (p3 - p1) * c.y;\n    float t2 = t * t;\n    float t3 = t * t * t;\n\n    return float((2.0 * p1 - 2.0 * p2 + v0 + v1) * t3 + (-3.0 * p1 + 3.0 * p2 - 2.0 * v0 - v1) * t2 + v0 * t + p1);\n}\n";

THREE.BAS.ShaderChunk["cubic_bezier"] = "vec3 cubicBezier(vec3 p0, vec3 c0, vec3 c1, vec3 p1, float t)\n{\n    vec3 tp;\n    float tn = 1.0 - t;\n\n    tp.xyz = tn * tn * tn * p0.xyz + 3.0 * tn * tn * t * c0.xyz + 3.0 * tn * t * t * c1.xyz + t * t * t * p1.xyz;\n\n    return tp;\n}\n";

THREE.BAS.ShaderChunk["ease_in_cubic"] = "float ease(float t, float b, float c, float d) {\n  return c*(t/=d)*t*t + b;\n}\n";

THREE.BAS.ShaderChunk["ease_in_out_cubic"] = "float ease(float t, float b, float c, float d) {\n  if ((t/=d/2.0) < 1.0) return c/2.0*t*t*t + b;\n  return c/2.0*((t-=2.0)*t*t + 2.0) + b;\n}\n";

THREE.BAS.ShaderChunk["ease_in_quad"] = "float ease(float t, float b, float c, float d) {\n  return c*(t/=d)*t + b;\n}\n";

THREE.BAS.ShaderChunk["ease_out_cubic"] = "float ease(float t, float b, float c, float d) {\n  return c*((t=t/d - 1.0)*t*t + 1.0) + b;\n}\n";

THREE.BAS.ShaderChunk["quaternion_rotation"] = "vec3 rotateVector(vec4 q, vec3 v)\n{\n    return v + 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);\n}\n\nvec4 quatFromAxisAngle(vec3 axis, float angle)\n{\n    float halfAngle = angle * 0.5;\n    return vec4(axis.xyz * sin(halfAngle), cos(halfAngle));\n}\n";


THREE.BAS.PrefabBufferGeometry = function(prefab, count) {
    THREE.BufferGeometry.call(this);

    this.prefabGeometry = prefab;
    this.prefabCount = count;
    this.prefabVertexCount = prefab.vertices.length;

    this.bufferDefaults();
};
THREE.BAS.PrefabBufferGeometry.prototype = Object.create(THREE.BufferGeometry.prototype);
THREE.BAS.PrefabBufferGeometry.prototype.constructor = THREE.BAS.PrefabBufferGeometry;

THREE.BAS.PrefabBufferGeometry.prototype.bufferDefaults = function() {
    var prefabFaceCount = this.prefabGeometry.faces.length;
    var prefabIndexCount = this.prefabGeometry.faces.length * 3;
    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;
    var prefabIndices = [];

    //console.log('prefabCount', this.prefabCount);
    //console.log('prefabFaceCount', prefabFaceCount);
    //console.log('prefabIndexCount', prefabIndexCount);
    //console.log('prefabVertexCount', prefabVertexCount);
    //console.log('triangles', prefabFaceCount * this.prefabCount);

    for (var h = 0; h < prefabFaceCount; h++) {
        var face = this.prefabGeometry.faces[h];
        prefabIndices.push(face.a, face.b, face.c);
    }

    var indexBuffer = new Uint32Array(this.prefabCount * prefabIndexCount);
    var positionBuffer = new Float32Array(this.prefabCount * prefabVertexCount * 3);

    this.setIndex(new THREE.BufferAttribute(indexBuffer, 1));
    this.addAttribute('position', new THREE.BufferAttribute(positionBuffer, 3));

    for (var i = 0, offset = 0; i < this.prefabCount; i++) {
        for (var j = 0; j < prefabVertexCount; j++, offset += 3) {
            var prefabVertex = this.prefabGeometry.vertices[j];

            positionBuffer[offset] = prefabVertex.x;
            positionBuffer[offset + 1] = prefabVertex.y;
            positionBuffer[offset + 2] = prefabVertex.z;
        }

        for (var k = 0; k < prefabIndexCount; k++) {
            indexBuffer[i * prefabIndexCount + k] = prefabIndices[k] + i * prefabVertexCount;
        }
    }
};

// todo test
THREE.BAS.PrefabBufferGeometry.prototype.bufferUvs = function() {
    var prefabFaceCount = this.prefabGeometry.faces.length;
    var prefabVertexCount = this.prefabVertexCount = this.prefabGeometry.vertices.length;
    var prefabUvs = [];

    for (var h = 0; h < prefabFaceCount; h++) {
        var face = this.prefabGeometry.faces[h];
        var uv = this.prefabGeometry.faceVertexUvs[0][h];

        prefabUvs[face.a] = uv[0];
        prefabUvs[face.b] = uv[1];
        prefabUvs[face.c] = uv[2];
    }

    var uvBuffer = this.createAttribute('uv', 2);

    for (var i = 0, offset = 0; i < this.prefabCount; i++) {
        for (var j = 0; j < prefabVertexCount; j++, offset += 2) {
            var prefabUv = prefabUvs[j];

            uvBuffer.array[offset] = prefabUv.x;
            uvBuffer.array[offset + 1] = prefabUv.y;
        }
    }
};

/**
 * based on BufferGeometry.computeVertexNormals
 * calculate vertex normals for a prefab, and repeat the data in the normal buffer
 */
THREE.BAS.PrefabBufferGeometry.prototype.computeVertexNormals = function() {
    var index = this.index;
    var attributes = this.attributes;
    var positions = attributes.position.array;

    if (attributes.normal === undefined) {
        this.addAttribute('normal', new THREE.BufferAttribute(new Float32Array(positions.length), 3));
    }

    var normals = attributes.normal.array;

    var vA, vB, vC,

        pA = new THREE.Vector3(),
        pB = new THREE.Vector3(),
        pC = new THREE.Vector3(),

        cb = new THREE.Vector3(),
        ab = new THREE.Vector3();

    var indices = index.array;
    var prefabIndexCount = this.prefabGeometry.faces.length * 3;

    for (var i = 0; i < prefabIndexCount; i += 3) {
        vA = indices[i + 0] * 3;
        vB = indices[i + 1] * 3;
        vC = indices[i + 2] * 3;

        pA.fromArray(positions, vA);
        pB.fromArray(positions, vB);
        pC.fromArray(positions, vC);

        cb.subVectors(pC, pB);
        ab.subVectors(pA, pB);
        cb.cross(ab);

        normals[vA] += cb.x;
        normals[vA + 1] += cb.y;
        normals[vA + 2] += cb.z;

        normals[vB] += cb.x;
        normals[vB + 1] += cb.y;
        normals[vB + 2] += cb.z;

        normals[vC] += cb.x;
        normals[vC + 1] += cb.y;
        normals[vC + 2] += cb.z;
    }

    for (var j = 1; j < this.prefabCount; j++) {
        for (var k = 0; k < prefabIndexCount; k++) {
            normals[j * prefabIndexCount + k] = normals[k];
        }
    }

    this.normalizeNormals();

    attributes.normal.needsUpdate = true;
};

THREE.BAS.PrefabBufferGeometry.prototype.createAttribute = function(name, itemSize) {
    var buffer = new Float32Array(this.prefabCount * this.prefabVertexCount * itemSize);
    var attribute = new THREE.BufferAttribute(buffer, itemSize);

    this.addAttribute(name, attribute);

    return attribute;
};

THREE.BAS.PrefabBufferGeometry.prototype.setAttribute4 = function(name, data) {
    var offset = 0;
    var array = this.geometry.attributes[name].array;
    var i, j;

    for (i = 0; i < data.length; i++) {
        var v = data[i];

        for (j = 0; j < this.prefabVertexCount; j++) {
            array[offset++] = v.x;
            array[offset++] = v.y;
            array[offset++] = v.z;
            array[offset++] = v.w;
        }
    }

    this.geometry.attributes[name].needsUpdate = true;
};
THREE.BAS.PrefabBufferGeometry.prototype.setAttribute3 = function(name, data) {
    var offset = 0;
    var array = this.geometry.attributes[name].array;
    var i, j;

    for (i = 0; i < data.length; i++) {
        var v = data[i];

        for (j = 0; j < this.prefabVertexCount; j++) {
            array[offset++] = v.x;
            array[offset++] = v.y;
            array[offset++] = v.z;
        }
    }

    this.geometry.attributes[name].needsUpdate = true;
};
THREE.BAS.PrefabBufferGeometry.prototype.setAttribute2 = function(name, data) {
    var offset = 0;
    var array = this.geometry.attributes[name].array;
    var i, j;

    for (i = 0; i < this.prefabCount; i++) {
        var v = data[i];

        for (j = 0; j < this.prefabVertexCount; j++) {
            array[offset++] = v.x;
            array[offset++] = v.y;
        }
    }

    this.geometry.attributes[name].needsUpdate = true;
};

THREE.BAS.BaseAnimationMaterial = function(parameters) {
    THREE.ShaderMaterial.call(this);

    this.shaderFunctions = [];
    this.shaderParameters = [];
    this.shaderVertexInit = [];
    this.shaderTransformNormal = [];
    this.shaderTransformPosition = [];

    this.setValues(parameters);
};
THREE.BAS.BaseAnimationMaterial.prototype = Object.create(THREE.ShaderMaterial.prototype);
THREE.BAS.BaseAnimationMaterial.prototype.constructor = THREE.BAS.BaseAnimationMaterial;

// abstract
THREE.BAS.BaseAnimationMaterial.prototype._concatVertexShader = function() {
    return '';
};

THREE.BAS.BaseAnimationMaterial.prototype._concatFunctions = function() {
    return this.shaderFunctions.join('\n');
};
THREE.BAS.BaseAnimationMaterial.prototype._concatParameters = function() {
    return this.shaderParameters.join('\n');
};
THREE.BAS.BaseAnimationMaterial.prototype._concatVertexInit = function() {
    return this.shaderVertexInit.join('\n');
};
THREE.BAS.BaseAnimationMaterial.prototype._concatTransformNormal = function() {
    return this.shaderTransformNormal.join('\n');
};
THREE.BAS.BaseAnimationMaterial.prototype._concatTransformPosition = function() {
    return this.shaderTransformPosition.join('\n');
};


THREE.BAS.BaseAnimationMaterial.prototype.setUniformValues = function(values) {
    for (var key in values) {
        if (key in this.uniforms) {
            var uniform = this.uniforms[key];
            var value = values[key];

            // todo add matrix uniform types
            switch (uniform.type) {
                case 'c': // color
                    uniform.value.set(value);
                    break;
                case 'v2': // vectors
                case 'v3':
                case 'v4':
                    uniform.value.copy(value);
                    break;
                case 'f': // float
                case 't': // texture
                default:
                    uniform.value = value;
            }
        }
    }
};

THREE.BAS.PhongAnimationMaterial = function(parameters, uniformValues) {
    THREE.BAS.BaseAnimationMaterial.call(this, parameters);

    var phongShader = THREE.ShaderLib['phong'];

    this.uniforms = THREE.UniformsUtils.merge([phongShader.uniforms, this.uniforms]);
    this.lights = true;
    this.vertexShader = this._concatVertexShader();
    this.fragmentShader = phongShader.fragmentShader;

    // todo add missing default defines
    uniformValues.map && (this.defines['USE_MAP'] = '');
    uniformValues.normalMap && (this.defines['USE_NORMALMAP'] = '');

    this.setUniformValues(uniformValues);
};
THREE.BAS.PhongAnimationMaterial.prototype = Object.create(THREE.BAS.BaseAnimationMaterial.prototype);
THREE.BAS.PhongAnimationMaterial.prototype.constructor = THREE.BAS.PhongAnimationMaterial;

THREE.BAS.PhongAnimationMaterial.prototype._concatVertexShader = function() {
    // based on THREE.ShaderLib.phong
    return [
        "#define PHONG",

        "varying vec3 vViewPosition;",

        "#ifndef FLAT_SHADED",

        "	varying vec3 vNormal;",

        "#endif",

        THREE.ShaderChunk["common"],
        THREE.ShaderChunk["uv_pars_vertex"],
        THREE.ShaderChunk["uv2_pars_vertex"],
        THREE.ShaderChunk["displacementmap_pars_vertex"],
        THREE.ShaderChunk["envmap_pars_vertex"],
        THREE.ShaderChunk["lights_phong_pars_vertex"],
        THREE.ShaderChunk["color_pars_vertex"],
        THREE.ShaderChunk["morphtarget_pars_vertex"],
        THREE.ShaderChunk["skinning_pars_vertex"],
        THREE.ShaderChunk["shadowmap_pars_vertex"],
        THREE.ShaderChunk["logdepthbuf_pars_vertex"],

        this._concatFunctions(),

        this._concatParameters(),

        "void main() {",

        this._concatVertexInit(),

        THREE.ShaderChunk["uv_vertex"],
        THREE.ShaderChunk["uv2_vertex"],
        THREE.ShaderChunk["color_vertex"],
        THREE.ShaderChunk["beginnormal_vertex"],

        this._concatTransformNormal(),

        THREE.ShaderChunk["morphnormal_vertex"],
        THREE.ShaderChunk["skinbase_vertex"],
        THREE.ShaderChunk["skinnormal_vertex"],
        THREE.ShaderChunk["defaultnormal_vertex"],

        "#ifndef FLAT_SHADED", // Normal computed with derivatives when FLAT_SHADED

        "	vNormal = normalize( transformedNormal );",

        "#endif",

        THREE.ShaderChunk["begin_vertex"],

        this._concatTransformPosition(),

        THREE.ShaderChunk["displacementmap_vertex"],
        THREE.ShaderChunk["morphtarget_vertex"],
        THREE.ShaderChunk["skinning_vertex"],
        THREE.ShaderChunk["project_vertex"],
        THREE.ShaderChunk["logdepthbuf_vertex"],

        "	vViewPosition = - mvPosition.xyz;",

        THREE.ShaderChunk["worldpos_vertex"],
        THREE.ShaderChunk["envmap_vertex"],
        THREE.ShaderChunk["lights_phong_vertex"],
        THREE.ShaderChunk["shadowmap_vertex"],

        "}"

    ].join("\n");
};






var recorder; 
var url = "http://10.6.0.123/files/21090000002E6C1B/112.65.117.174/m10.music.126.net/20170521105304/d98467df16c14f3062d3d06e8ba282ea/ymusic/ff2f/0701/cfa9/01670d046f07e60b58a7602966c6ce19.mp3"; 
var audio = document.querySelector('audio');  
function startRecording() {  
    HZRecorder.get(function (rec) {  
    recorder = rec;  
    recorder.start();  
    });  
}                
function obtainRecord(){  
    var record = recorder.getBlob();  
    debugger;  
};  
              

function stopRecord(){  
    recorder.stop(); 
    recorder.upload("http://10.131.252.141/home/inspur/Documents/hackx_upload/", callback); 
};  
   
function callback(state, e){
    console.log(state);
}

function playRecord(url){  
    document.getElementById("ai-feedback").src=url;
    // recorder.play(audio);
    var rythm = new Rythm();
    rythm.setMusic(url);
    // rythm.addRythm('swing1', 'swing', 0, 10);
    //rythm.addRythm("shake1", 'shake', 0, 10);
    // rythm.addRythm('twist1', 'twist', 0, 10);
    // rythm.addRythm('radius1', 'radius', 0, 10, {
    //   min: 0,
    //   max: 30
    // });


    //rythm.start();
     audio.play(); 

};  


//<![CDATA[
$(document).ready(function(){
 
	new jPlayerPlaylist({
		jPlayer: "#jquery_jplayer_2",
		cssSelectorAncestor: "#jp_container_2"
	}, [
		{
			title:"Cro Magnon Man",
			mp3:"mp3/TSP-01-Cro_magnon_man.mp3",
			oga:"ogg/TSP-01-Cro_magnon_man.ogg"
		},
		{
			title:"Your Face",
			mp3:"mp3/TSP-05-Your_face.mp3",
			oga:"ogg/TSP-05-Your_face.ogg"
		},
		{
			title:"Cyber Sonnet",
			mp3:"mp3/TSP-07-Cybersonnet.mp3",
			oga:"ogg/TSP-07-Cybersonnet.ogg"
		},
		{
			title:"Tempered Song",
			mp3:"mp3/Miaow-01-Tempered-song.mp3",
			oga:"ogg/Miaow-01-Tempered-song.ogg"
		},
		{
			title:"Hidden",
			mp3:"mp3/Miaow-02-Hidden.mp3",
			oga:"ogg/Miaow-02-Hidden.ogg"
		},
		{
			title:"Lentement",
			free:true,
			mp3:"mp3/Miaow-03-Lentement.mp3",
			oga:"ogg/Miaow-03-Lentement.ogg"
		},
		{
			title:"Lismore",
			mp3:"mp3/Miaow-04-Lismore.mp3",
			oga:"ogg/Miaow-04-Lismore.ogg"
		},
		{
			title:"The Separation",
			mp3:"mp3/Miaow-05-The-separation.mp3",
			oga:"ogg/Miaow-05-The-separation.ogg"
		},
		{
			title:"Beside Me",
			mp3:"mp3/Miaow-06-Beside-me.mp3",
			oga:"ogg/Miaow-06-Beside-me.ogg"
		},
		{
			title:"Bubble",
			free:true,
			mp3:"mp3/Miaow-07-Bubble.mp3",
			oga:"ogg/Miaow-07-Bubble.ogg"
		},
		{
			title:"Stirring of a Fool",
			mp3:"mp3/Miaow-08-Stirring-of-a-fool.mp3",
			oga:"ogg/Miaow-08-Stirring-of-a-fool.ogg"
		},
		{
			title:"Partir",
			free: true,
			mp3:"mp3/Miaow-09-Partir.mp3",
			oga:"ogg/Miaow-09-Partir.ogg"
		},
		{
			title:"Thin Ice",
			mp3:"mp3/Miaow-10-Thin-ice.mp3",
			oga:"ogg/Miaow-10-Thin-ice.ogg"
		}
	], {
		swfPath: "../../dist/jplayer",
		supplied: "oga, mp3",
		wmode: "window",
		useStateClassSkin: true,
		autoBlur: false,
		smoothPlayBar: true,
		keyEnabled: true
	});
});
</script>

//]]>
</div>
</div>
</body>
</html>